{"title":"Анлиз рельефа","markdown":{"yaml":{"title":"Анлиз рельефа"},"headingText":"Цифровая модель рельефа","containsRefs":false,"markdown":"\n\n\nЦифровая модель рельефа (ЦМР) — это растровое представление непрерывной поверхности, обычно относящееся к поверхности Земли[^1].\n\n[^1]: Что такое цифровые модели рельефа (ЦМР) - <https://pro.arcgis.com/ru/pro-app/latest/tool-reference/spatial-analyst/exploring-digital-elevation-models.htm>\n\n::: callout-important\nРазличают цифровую модель рельефа и цифровую модель местности. Разница между ними состоит в том, что цифровая модель местности включает в себя все объекты, расположенные на поверхности, тогда как цифровая модель рельефа - это только поверхность земли без растительности и строений.\n\n![Источник: https://innoter.com/articles/matritsa-vysot/](images/matrix_height_04.webp){fig-align=\"center\"}\n:::\n\nЦифровые модели рельефа, как правило, строят либо по результатам интерполяции, либо на основе открытых данных.\n\nСамым распространенным источником данных о рельефе является цифровая модель рельефа SRTM (shuttle radar topographic mission). Эта цифровая модель была получена в 2000 году на основе спутниковой радарной съемки. Она охватывает планету между 54 градусами южной широты и 60 градусами северной широты. Подробнее на русском можно почитать про нее [здесь](https://gis-lab.info/qa/srtm.html)\n\nСкачать данные SRTM можно на сайте Геологической службы США (<https://earthexplorer.usgs.gov/>) или с помощью плагина [SRTM downloader](https://plugins.qgis.org/plugins/SRTM-Downloader/)[^2].\n\n[^2]: **Плагин SRTM-Downloader — загрузка SRTM с сервера прямо в QGIS** <https://cartetika.ru/tpost/98m7ngx971-plagin-srtm-downloader-zagruzka-srtm-s-s>\n\n::: callout-warning\nДля использования модуля и загрузки данных напрямую из QGIS все равно необходимы реквизиты аккаунта на сайте USGS.\n:::\n\n::: callout-warning\nЗначительным недостатком SRTM является ее ограниченный пространственный охват, из-за которого значительная часть нашей страны не покрыта этой цифровой моделью рельефа.\n:::\n\nДля примера и выполнения работы были скачаны данные для окрестностей Эльбруса (файл [dem_elbrus.tiff](https://drive.google.com/file/d/1FYFUxG7s_T-bEZV4Azu-G7FVfVIDZ86_/view?usp=sharing)).\n\nИз SRTM выгружается сразу целая 1-градусная трапеция (фрагмент 1 градус по широте и 1 градус по долготе), в этом случае трапеция была обрезана до более маленького фрагмента (вообще не очень рекомендую работать с большими растрами, охватывающими сразу градус и более по долготе и широте).\n\n::: callout-note\nБолее современной и точной цифровой моделью рельефа является модель FABDEM, к тому же она действительно глобальная и охватывает всю территорию земного шара.\n\nНемного почитать о ней на русском можно по [ссылке](https://cartetika.ru/tpost/0l2nfnr1l1-tsifrovaya-model-relefa-fabdem).\n\nСамое главное ее отличие от более ранних моделей в наличии процессинга и удалении из нее объектов, расположенных на поверхности Земли.\n\n![Источник: https://iopscience.iop.org/article/10.1088/1748-9326/ac4d4f](images/erlac4d4ff1_hr.jpg){fig-align=\"center\"}\n\nСама модель является открытой и данные можно скачать по ссылке из репозитория - <https://data.bris.ac.uk/data/dataset/s5hqmjcdj8yo2ibzi9b4ew3sn>\n\nВсе данные организованы в архивы, которые включают в себя охват 10 широты на 10 градусов долготы. Растровые данные внутри архивов - это одноградусные трапеции (как и в SRTM).\n\nДля того, чтобы понять, какой именно архив и файл из него нужен вам на исследуемую территорию, можно скачать файл ***FABDEM_v1-2_tiles.geojson*** и открыть его либо в QGIS, либо с использованием сервиса geojson.io. Прямоугольники в этом файле показывают одноградусные трапеции, а в их атрибутах указано название архива и файла.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.21.33.png){fig-align=\"center\"}\n:::\n\nВ каждой ячейке исходного растрового изображения содержится значение высоты.\n\nДобавление растрового слоя осуществляется через строку меню *Слой* $\\longrightarrow$ *Добавить слой* $\\longrightarrow$ *Добавить растровый слой*.\n\n![](images/191.png)\n\nПосле открытия файла его лучше сразу перепроецировать на лету в EPSG:3857.\n\n::: callout-tip\nПерепроецирование на лету не будет изменять систему координат слоя, а только изменит систему координат проекта и то, как ваша карта будет отображаться на экране.\n\nПерепроецирование на лету может быть выполнено с использованием кнопки ![](images/Снимок%20экрана%202025-03-03%20в%2017.37.13.png){width=\"200\"} в правом нижнем углу основного окна программы.\n:::\n\nВ результате будет открыто изображение рельефа в оттенках серого цвета.\n\n![](images/192.PNG)\n\nЭто изображение можно сделать цветным, для этого нужно открыть свойства слоя. В настройках стиля нужно выбрать тип изображения **Одноканальное псевдоцветное**.\n\nОдноканальное здесь очевидно потому, что изображение не поделено на каналы и существует только в одном.\n\n![](images/193.PNG)\n\n![](images/194.PNG)\n\nГрадиент можно также создать самостоятельно с помощью редактора градиентов.\n\n![](images/195.PNG)\n\n![](images/196.PNG)\n\nИли выбрать из готового каталога градиентов. Для этого при создании нового градиента нужно выбрать каталог **cpt-city**.\n\n![](images/198.PNG)\n\nДалее в каталоге слева выбрать тип градиента Topography и подобрать нужный градиент (можно взять elevation или с3t3).\n\n![](images/199.PNG)\n\n![Градиент c3t3](images/200.PNG)\n\n# Теневой рельеф[^3]\n\n[^3]: <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#hillshade>\n\n## Расчет теневого рельефа\n\nДля более наглядного отображения рельефа на карте рассчитывается теневой рельеф, который строится с использованием позиции источника направленного света, или теневая отмывка.\n\n![](images/201.PNG)\n\nВ данном случае одним из самых важных параметров является **Масштабирование по Z -** этот параметр позволяет соотнести между собой единицы измерения плановых координат и высот. В нашем случае высоты в ячейках растра приведены в метрах, а координаты - в градусах., кроме того, стоит учитывать, что в географических системах координат искажение зависит от долготы.\n\nС этим можно справиться двумя способами - перепроецировать растра в прямоугольную систему координат или задать масштабирование по Z (Z-factor). Фактически с помощью этого коэффициента мы переходим от градусов к метрам. Так как у нас окрестности Эльбруса, то можно воспользоваться значением коэффициента для 40 градусов долготы - 0.00001171.[^4]\n\n[^4]: <https://www.esri.com/arcgis-blog/products/product/imagery/setting-the-z-factor-parameter-correctly/>\n\nАзимут и вертикальный угол задают положение источника света.\n\n![Теневой рельеф (теневая отмывка)](images/202.PNG)\n\nЭтот теневой рельеф можно использовать, чтобы добавить дополнительный объем подложке (предварительно нужно добавить) или исходному рельефу растра. Для этого нужно открыть свойства слоя с теневым рельефом и изменить режим смешивания на Добавление, Осветление или Затемнение (также можно поэкспериментировать с настройками яркости и контрастности).\n\n![](images/203.PNG)\n\n![](images/204.PNG)\n\n![](images/205.PNG)\n\n![](images/206.PNG)\n\n::: callout-tip\nТакже можно воспользоваться функцией Цветной рельеф, которая позволяет создавать классы автоматически и задавать им цвет.\n\n![](images/209.PNG)\n\n![](images/210.PNG)\n\nС использованием такого растра может быть построена трехмерная поверхность, отображающая рельеф местности, а также выполнен ряд вычислений для анализа рельефа.\n\n![](images/clipboard-3288096992.png){fig-align=\"center\" width=\"492\"}\n\nВсе растровые операции здесь осуществляются за счет разности значений между ячейками.\n:::\n\n## Настройка теневого рельефа как стиля растрового слоя\n\nРассчитывать теневой рельеф и сохранять его в отдельный слой не обязательно, вы можете просто выбрать его как тип стиля для растрового слоя в настройках свойств.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.31.31.png){fig-align=\"center\"}\n\nПолученный теневой рельеф после настройки будет отображен на карте.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.32.40.png){fig-align=\"center\"}\n\n::: callout-caution\nПри создании теневого рельефа с использованием настроек стиля растрового слоя на карте могут появляться артефакты - небольшая \"рябь\" в картинке.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.33.35.png){fig-align=\"center\"}\n:::\n\n## Использование модуля Terrain shading\n\nБолее художественных результатов при создании теневого рельефа позволяет добиться модуль [Terrain shading](https://plugins.qgis.org/plugins/TerrainShading/).\n\nЧуть подробнее про его функции можно почитать в [блоге разработчика](https://landscapearchaeology.org/qgis-terrain-shading/).\n\nУстановка модуля осуществляется стандартно (*Модули* $\\longrightarrow$ *Управление модулями*). После установки модуль должен появиться у вас в панели Инструменты анализа.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.47.37.png){fig-align=\"center\" width=\"600\"}\n\nМодуль содержит сразу три функции, которые позволяют строить теневую отмывку:\n\n-   *Hillshade (terrain shading)* - аналогичен стандартному построению теневого рельефа;\n\n![Результат расчета Hillshade](images/Снимок%20экрана%202025-03-13%20в%2016.52.57.png){fig-align=\"center\"}\n\n-   *Shadow depth* - инструмент для генерации теней;\n\n![Результат расчета Shadow depth](images/Снимок%20экрана%202025-03-13%20в%2016.53.46.png){fig-align=\"center\"}\n\n-   *Toposhade* - комбинация теневого рельефа и индекса топографического положения (о нем будет еще чуть дальше), который показывает выпуклость и вогнутость рельефа. Такая комбинация позволяет добиться более выраженной карты теневого рельефа.\n\n![Результат расчета Toposhade](images/Снимок%20экрана%202025-03-13%20в%2016.54.34.png){fig-align=\"center\"}\n\n::: callout-tip\nПолученные новые растры можно комбинировать друг с другом и другими слоями для получения более красивого результата.\n\n![Shadow depth и Hillshade (для обоих установлен режим смешивания Затемнение) в сочетании с подложкой 2GIS](images/Снимок%20экрана%202025-03-13%20в%2016.55.57.png){fig-align=\"center\"}\n:::\n\n# Расчет параметров рельефа\n\n## Крутизна склонов[^5]\n\n[^5]: Документация функции <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#slope>\n\nРасчет крутизны склонов или их уклона и экспозиции осуществляется на основе производных первого порядка.\n\n![Определение основных геоморфометрических параметров по Zevenbergen, Thorne (1987). Источник: https://gis-lab.info/qa/geomorphometric-parameters-theory.html](images/800px-Geomorpho_theory_03.png){fig-align=\"center\"}\n\n### Расчет крутизны склонов\n\nРассчитаем крутизну склонов - угол наклона каждого склона в градусах.\n\n![](images/207.PNG)\n\n![](images/208.PNG)\n\n### Выделение территорий пригодных для строительства с учетом уклона\n\nДля того, чтобы выделить области пригодные для строительства, воспользуемся переклассификацией растра.\n\nПри переклассификации будем рассматривать территории с уклоном менее 10 %.\n\n![](images/photo_2025-02-24_21-18-02.jpg){fig-align=\"center\" width=\"800\"}\n\nТак как уклон был рассчитан в градусах, а параметр пригодности для строительства задан в процентах, то пересчитаем этот параметр в градусы по формуле:\n\n$$\nSlope_{degree}=arctg(\\dfrac{Slope_{percent}}{100})\n$$\n\nПолученное значение пригодности - 6 градусов.\n\nПереклассифицируем растр и выделим области пригодные или непригодные для строительства.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2012.12.49.png){fig-align=\"center\"}\n\n::: callout-important\nОбратите внимание, что здесь в дополнительных параметрах можно указать, как именно будут задаваться границы интервалов, то есть будут ли включаться в них нижний или верхний предел интервала.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2012.18.05.png){fig-align=\"center\" width=\"600\"}\n:::\n\nВ таблице реклассификации следует ввести границы интервалов и соответствующее им значение (эти значения должны быть целочисленными.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2012.12.25.png){fig-align=\"center\"}\n\nВ результате будет получен дискретный растр с двумя значениями (или с тем количеством значений классов, которое вы указали в таблице реклассификации.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2012.21.50.png){fig-align=\"center\"}\n\n## Экспозиция склонов[^6]\n\n[^6]: Экспозиция - <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#aspect>\n\n*Экспозиция поверхности – угол по часовой стрелке между определенным направлением (как правило, на север) и проекцией уклона на горизонтальную плоскость; фиксирует направление (азимут) максимального уклона (градиента) земной поверхности*[^7].\n\n[^7]: Основные геоморфометрические параметры: теория - [https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5\\_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5\\_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B](https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B,){.uri}\n\nЭта функция позволяет определить ориентацию склонов по сторонам света.\n\n![](images/211.PNG)\n\n![](images/212.PNG)\n\n## Расчет неоднородности рельефа[^8]\n\n[^8]: <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#ruggedness-index>\n\nТакже по растру с данными о рельефе может быть рассчитана неоднородность рельефа.\n\nЭтот показатель рассчитывается на основе разности значений между пикселями в сетке 3 на 3. Таким образом, каждый полученный пиксель содержит разницу между центральным пикселем и 8 его окружащими.\n\n![Riley et al (1999) “A Terrain ruggedness Index That Quantifies Topographic heterogeneity”[^9]](images/Снимок%20экрана%202025-03-14%20в%2014.09.56.png){fig-align=\"center\"}\n\n[^9]: <https://download.osgeo.org/qgis/doc/reference-docs/Terrain_Ruggedness_Index.pdf>\n\n[^10]: <https://download.osgeo.org/qgis/doc/reference-docs/Terrain_Ruggedness_Index.pdf>\n\n![](images/213.PNG)\n\n![](images/214.PNG)\n\n# Построение трехмерной поверхности\n\nТакже QGIS поддреживает отображение трехмерных поверхностей. Для этого нужно просто в строке меню выбрать **Вид - Новая 3D карта**.\n\n![](images/215.png)\n\nПосле чего в окне программы появится окно трехмерной карты (перемещение по карте левой кнопкой мыши, поворот и наклон - колесико, приближение - правая кнопка мыши).\n\n![](images/216.PNG)\n\nСразу после открытия нового окна поверхность все еще является плоской, потому что не задано на основе чего строить трехмерную поверхность.\n\nВ окне трехмерной карты нужно нажать кнопку **Настройки** (в панели значков крайняя справа) и в открывшемся окне настроек выбрать тип **DEM (raster layer)**, **высота** (растровый слой с высотами) и **вертикальный масштаб** (здесь лучше всзять что-то от 1 до 5, чтобы поверхность была повыразительнее).\n\nДополнительно можно добавить **Terrain shading** (фактически теневая отмывка) и подкорректировать **tile resolution** (чем больше, тем более подробным будет рельеф), и **skirt height** (если правильно нашла - высота подставки под саму поверхность).\n\n![](images/217.PNG)\n\nПосле чего в окне будет отображена трехмерная поверхность.\n\n![](images/218.PNG)\n\n# Создание горизонталей\n\nИз растра со значениями высот могут быть извлечены горизонтали\n\n![](images/219.png)\n\nРасстояние между изолиниями - это фактически высота сечения рельефа, то есть через сколько мы будем проводить горизонтали.\n\n![](images/220.PNG)\n\nПолученные изолинии\n\n![](images/221.PNG)\n\nНастроим горизонтали таким образом, чтобы каждая пятая была утолщенной, добавим подписи и настроим их так, чтобы они были \"головой вверх\".\n\nНачнем с настройки толщины линий. Для этого в свойствах слоя выберем настройку толщины в зависимости от выражения.\n\n![](images/222.png)\n\nДалее пропишем логическое выражение: **if(\"ELEV\"%500=0,0.7,0.3)**. В этом выражении перед запятой прописано условие - высота горизонтали делится на 500 без остатка, потом толщина линии, если условие выполняется, и толщина, если условие не выполняется.\n\n![](images/223.PNG)\n\nРезультат\n\n![](images/224.PNG)\n\nДобавим подписи.\n\n![](images/225.PNG)\n\nНо при таком добавлении подписей, будут подписаны все горизонтали, а мы хотим подписать только утолщенные. Для этого нужно прописать выражение, подобное тому, что мы писали выше: **if(\"ELEV\"%500=0,\"ELEV\",\"\").**\n\n![](images/226.PNG)\n\nДобавим белую обводку подписям, чтобы они не сливались с горизонталями\n\n![](images/227.PNG)\n\nСделаем так, чтобы они размещались на линии и изгибались в соответствии с ней.\n\n![](images/228.PNG)\n\nИ настроим подписи так, чтобы все они смотрели головой в сторону увеличения высоты.\n\n![](images/229.PNG)\n\n![](images/230.PNG)\n\nВ результате получим горизонтали, где каждая пятая будет утолщена и подписана головой в сторону увеличения.\n\n![](images/231.PNG)\n\n# Построение профиля местности\n\nВ актуальных версиях программы построения профиля местности по цифровой модели рельефа является функцией по умолчанию. Этот инструмент можно открыть из строки меню *Вид* $\\longrightarrow$ *Профиль высот*.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2013.07.28.png){fig-align=\"center\" width=\"600\"}\n\nОкно профиля высот открывается в нижней части интерфейса. Ваша цифровая модель рельефа (если растр с ней загружен в проект должна автоматически добавиться в левую часть окна построения профиля.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2014.14.16.png){fig-align=\"center\"}\n\n::: callout-important\nЕсли ваша цифровая модель рельефа не добавилась в высотный профиль автоматически, то вам нужно проверить ее настройки.\n\nВ свойствах слоя (открываются двойным кликом или кликом правой кнопки мыши и выбором пункта *Свойства* из открывшегося контекстного меню) необходимо найти пункт *Высота* и поставить галочку напротив настройки *\"Представляет собой данные высоты\"*.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2014.16.24.png){fig-align=\"center\"}\n\nПосле этого ваша цифровая модель будет автоматически добавлена в окно высотного профиля.\n:::\n\nПостроение профиля может происходить двумя способами:\n\n-   *Захват кривой* ![](images/Снимок%20экрана%202025-03-12%20в%2014.19.51.png){width=\"35\" height=\"32\"} - отрисовка линии профиля осуществляется вручную прямо на карте;\n\n-   *Захват кривой из объекта* ![](images/Снимок%20экрана%202025-03-12%20в%2014.20.03.png){width=\"36\"} - использование уже существующей линии из векторного слоя.\n\nВ первом случае необходимо просто нарисовать нужную вам линию профиля (она может быть отрисована как любая ломаная линия), по которой будет происходить построения.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2014.22.05.png){fig-align=\"center\"}\n\nПри перемещении курсора по графику или линии профиля вы увидите перемещающуюся точку, показывающую конкретное положение.\n\n```{=html}\n<iframe width=\"800\" height=\"400\" src=\"images/Запись экрана 2025-03-12 в 14.24.11.mp4\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe>\n```\n\nФункция прилипания ![](images/Снимок%20экрана%202025-03-12%20в%2014.49.40.png){width=\"38\" height=\"34\"} как и при обычной векторизации позволяет использовать другие объекты в качестве исходных.\n\nПолученный профиль вы можете сохранить в виде картинки графика или файла pdf ![](images/Снимок%20экрана%202025-03-12%20в%2014.51.16.png){width=\"67\" height=\"35\"} или же результаты могут быть сохранены в виде линии профиля (в двумерном и трехмерном видах) для последующего использования в ГИС или CAD программах и в виде таблицы значений высот вдоль профиля.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2014.51.32.png){fig-align=\"center\" width=\"400\"}\n\n# Выявление форм рельефа\n\n::: callout-warning\nТе инструменты и функции, которые описаны, начиная с этого раздела, к сожалению, могут работать нестабильно или не запуститься вообще (может зависеть от вашей системы и настроек компьютера).\n:::\n\n::: callout-important\nДля нижеописанных расчетов используются инструменты программы SAGA. Как и QGIS это бесплатное программное обеспечение.\n\nЕе вы можете установить себе на компьютер как отдельное приложение, скачав, например, по [ссылке](https://sourceforge.net/projects/saga-gis/). Возможно она у вас уже установлена вместе с QGIS (если вы устанавливали его пакетно).\n\nЛибо вы можете воспользоваться этими инструментами напрямую из QGIS. Для этого необходимо установить модуль *Processing Saga NextGen Provider*, после чего скачать программу для своей операционной системы по [ссылке](https://sourceforge.net/projects/saga-gis/) и разместить на своем компьютере в папке в надежном месте. Далее в настройках программы QGIS вам нужно прописать, где же хранится SAGA.[^11]\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.33.30.png){fig-align=\"center\"}\n\nУстановку для Windows можно посмотреть в видео по [ссылке](https://www.youtube.com/watch?v=VKdaripCups&ab_channel=cornell-gis).\n:::\n\n[^11]: <https://gis.stackexchange.com/questions/468320/installing-saga-next-gen-binaries-in-qgis-on-a-mac>\n\n## Расчет структурных линий рельефа\n\nВыделение структурны линий рельефа можно осуществить с использованием инструмента *Surface specific points* в наборе инструментов SAGA.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2014.15.41.png){fig-align=\"center\"}\n\nЧем большее значение порога вы установите, тем более крупные структурные линии будут выделяться.\n\n![](images/image_2025-03-14_14-16-59.png){fig-align=\"center\"}\n\n## Определение выпуклых и вогнутых форм рельеф\n\nФормы рельефа определяются на основе *индекса топографического положения (Topographic position index - TPI)*. Этот индекс позволяет классифицировать формы рельефа по высоте конкретного пикселя относительно соседей: если он ниже, то значение индекса будет отрицательным и он будет отнесен к вогнутой форме рельефа; если он выше соседей, то индекс будет больше нуля и этот пиксель будет классифицирован как выпуклая часть рельефа.\n\n![Источник: https://landscapearchaeology.org/2019/tpi/](images/TPI_diagram.png){fig-align=\"center\"}\n\n![Источник: https://chuck-sutherland.blogspot.com/2019/10/topographic-position-index-tpi-as.html](images/48880191738_a91f4757a2_c.jpg){fig-align=\"center\"}\n\n### Расчет стандартными инструментами\n\nИндекс топографического положения может быть рассчитан с использованием стандартного инструмента из строки меню: *Растр* $\\longrightarrow$ *Анализ* $\\longrightarrow$ *Индекс топографического положения (TPI)*.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.41.05.png){fig-align=\"center\"}\n\nЗдесь достаточно указать растр, используемый для расчета и необходимость обработки краев: так как расчеты осуществляются с использованием движущегося окна вокруг каждого из пикселей, то края обычно не обрабатываются, так как эти пиксели не имеют достаточного числа соседей.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.48.52.png){fig-align=\"center\"}\n\nПолученный результат вы увидите на растре (на картинке ниже взята цветная шкала, по умолчанию вы получите изображение в оттенках серого).\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.54.09.png){fig-align=\"center\" width=\"647\"}\n\nВ примере превалируют либо ровные области, либо небольшие выпуклости и вогнутости рельефа.\n\nОднако такой результат может быть еще связан с небольшим окном для расчетов. Другие варианты расчета дают большую гибкость и позволяют четче выделять формы рельефа.\n\n### Расчет с использованием функций SAGA\n\nВ наборе инструментов SAGA есть целая группа, предназначенная специально для морфометрического анализа рельефа - *Terrain analysis - Morphometry*, среди которых в том числе есть и расчет индекса топографического положения - *Topographic position index (tpi)*.\n\nИспользование этого инструмента в отличие от стандартного дает больше контроля пользователю, так как здесь можно выбирать размер ячеек для анализа, а также задавать весовые значения.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.56.44.png){fig-align=\"center\"}\n\nЗа счет большей адаптивности этого инструмента получается более легко и наглядно интерпретируемый результат.\n\n![](images/image_2025-03-14_12-16-51.png){fig-align=\"center\"}\n\n::: callout-note\nТакже есть инструмент для классификации форм рельефа на основе индекса топографического положения - *Tpi based land form classification*.\n\nНо, к сожелению, у меня расчет этим инструментов так и не окончился успехом.\n:::\n\n### Расчет с использованием модуля Terrain shading\n\n:::: callout-important\nДля расчетов топографического индекса положения необходимо, чтобы данные были в прямоугольной системе координат, поэтому растр с цифровой моделью рельефа необходимо перепроецировать: *Растр* $\\longrightarrow$ *Проекции* $\\longrightarrow$ *Деформация (перепроецирование)*.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.40.23.png){fig-align=\"center\"}\n\n::: callout-tip\nНаиболее оптимальным является перепроецирование в плоскую прямоугольную систему координат из группы систем координат UTM. Для расчета нужной вам зоны системы координат можно воспользоваться сервисом по ссылке <https://www.latlong.net/lat-long-utm.html>\n:::\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.43.39.png){fig-align=\"center\"}\n::::\n\nДля расчета индекса топографического положения воспользуемся инструментом *Topographic position (TPI)*.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.45.22.png){fig-align=\"center\"}\n\nТак же как и для инструментов SAGA вы можете здесь настроить возможность использования весов и радиус обработки.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.48.19.png){fig-align=\"center\"}\n\n::: callout-tip\nЧем больший радиус вы установите, тем более крупные формы рельефа будут обнаруживаться.\n:::\n\nНедостатком полученного результата будет являться добавление дополнительных пикселей вдоль границ исходного растра со значениями, лежащими за пределами корректного диапазона индекса.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.52.26.png){fig-align=\"center\"}\n\nОднако это можно исправить настройкой стиля слоя, в которых можно указать минимальные и максимальные значения растра и исключить все, что не попадает в пределы диапазона.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.52.02.png){fig-align=\"center\"}\n\nПолученный результат хоть и будет содержать небольшую рамку, но уже не будет так сильно искажать интерпретацию.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.56.12.png){fig-align=\"center\"}\n\nТакже полученный растр можно обрезать по маске.\n\n::: callout-tip\nКак показали несколько попыток расчета можно попробовать осуществить его для растра в географической системе координат, так вы не получите дополнительных полей по краям.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.50.19.png){fig-align=\"center\"}\n:::\n\n::: callout-tip\nДополнительно вы можете наложить на свой растр с индексом топографического положения горизонтали, чтобы понять, действительно ли рельеф изменяется согласно полученным значениям.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2014.14.08.png){fig-align=\"center\"}\n:::\n\n# Классификация форм рельефа\n\nАлгоритм классификации форм рельефа в наборе инструментов SAGA основан на статье **Iwahashi, J. & Pike, R.J. (2007):** Automated classifications of topography from DEMs by an unsupervised nested-means algorithm and a three-part geometric signature.\n\nВ соответствии с предложенными авторами алгоритмом вся территория автоматически делится на категории по форме поверхности с использованием - градиента склона, локальной выпуклости и текстуре поверхности.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2014.26.11.png){fig-align=\"center\"}\n\n![](images/image_2025-03-14_14-21-53.png){fig-align=\"center\"}\n\n# Определение открытых и закрытых элементов рельефа\n\nДля расчета открытых и закрытых форм рельефа в комплекте инструментов SAGA есть *Topographic openness*, которая позволяет рассчитать два растра: с открытыми формами и закрытыми соответственно.\n\n![](images/image_2025-03-14_13-13-14.png){fig-align=\"center\"}\n\n![Открытые выпуклые формы рельефа](images/image_2025-03-14_13-13-52.png){fig-align=\"center\"}\n\n![Закрытые формы рельефа](images/image_2025-03-14_13-14-15.png){fig-align=\"center\"}\n","srcMarkdownNoYaml":"\n\n# Цифровая модель рельефа\n\nЦифровая модель рельефа (ЦМР) — это растровое представление непрерывной поверхности, обычно относящееся к поверхности Земли[^1].\n\n[^1]: Что такое цифровые модели рельефа (ЦМР) - <https://pro.arcgis.com/ru/pro-app/latest/tool-reference/spatial-analyst/exploring-digital-elevation-models.htm>\n\n::: callout-important\nРазличают цифровую модель рельефа и цифровую модель местности. Разница между ними состоит в том, что цифровая модель местности включает в себя все объекты, расположенные на поверхности, тогда как цифровая модель рельефа - это только поверхность земли без растительности и строений.\n\n![Источник: https://innoter.com/articles/matritsa-vysot/](images/matrix_height_04.webp){fig-align=\"center\"}\n:::\n\nЦифровые модели рельефа, как правило, строят либо по результатам интерполяции, либо на основе открытых данных.\n\nСамым распространенным источником данных о рельефе является цифровая модель рельефа SRTM (shuttle radar topographic mission). Эта цифровая модель была получена в 2000 году на основе спутниковой радарной съемки. Она охватывает планету между 54 градусами южной широты и 60 градусами северной широты. Подробнее на русском можно почитать про нее [здесь](https://gis-lab.info/qa/srtm.html)\n\nСкачать данные SRTM можно на сайте Геологической службы США (<https://earthexplorer.usgs.gov/>) или с помощью плагина [SRTM downloader](https://plugins.qgis.org/plugins/SRTM-Downloader/)[^2].\n\n[^2]: **Плагин SRTM-Downloader — загрузка SRTM с сервера прямо в QGIS** <https://cartetika.ru/tpost/98m7ngx971-plagin-srtm-downloader-zagruzka-srtm-s-s>\n\n::: callout-warning\nДля использования модуля и загрузки данных напрямую из QGIS все равно необходимы реквизиты аккаунта на сайте USGS.\n:::\n\n::: callout-warning\nЗначительным недостатком SRTM является ее ограниченный пространственный охват, из-за которого значительная часть нашей страны не покрыта этой цифровой моделью рельефа.\n:::\n\nДля примера и выполнения работы были скачаны данные для окрестностей Эльбруса (файл [dem_elbrus.tiff](https://drive.google.com/file/d/1FYFUxG7s_T-bEZV4Azu-G7FVfVIDZ86_/view?usp=sharing)).\n\nИз SRTM выгружается сразу целая 1-градусная трапеция (фрагмент 1 градус по широте и 1 градус по долготе), в этом случае трапеция была обрезана до более маленького фрагмента (вообще не очень рекомендую работать с большими растрами, охватывающими сразу градус и более по долготе и широте).\n\n::: callout-note\nБолее современной и точной цифровой моделью рельефа является модель FABDEM, к тому же она действительно глобальная и охватывает всю территорию земного шара.\n\nНемного почитать о ней на русском можно по [ссылке](https://cartetika.ru/tpost/0l2nfnr1l1-tsifrovaya-model-relefa-fabdem).\n\nСамое главное ее отличие от более ранних моделей в наличии процессинга и удалении из нее объектов, расположенных на поверхности Земли.\n\n![Источник: https://iopscience.iop.org/article/10.1088/1748-9326/ac4d4f](images/erlac4d4ff1_hr.jpg){fig-align=\"center\"}\n\nСама модель является открытой и данные можно скачать по ссылке из репозитория - <https://data.bris.ac.uk/data/dataset/s5hqmjcdj8yo2ibzi9b4ew3sn>\n\nВсе данные организованы в архивы, которые включают в себя охват 10 широты на 10 градусов долготы. Растровые данные внутри архивов - это одноградусные трапеции (как и в SRTM).\n\nДля того, чтобы понять, какой именно архив и файл из него нужен вам на исследуемую территорию, можно скачать файл ***FABDEM_v1-2_tiles.geojson*** и открыть его либо в QGIS, либо с использованием сервиса geojson.io. Прямоугольники в этом файле показывают одноградусные трапеции, а в их атрибутах указано название архива и файла.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.21.33.png){fig-align=\"center\"}\n:::\n\nВ каждой ячейке исходного растрового изображения содержится значение высоты.\n\nДобавление растрового слоя осуществляется через строку меню *Слой* $\\longrightarrow$ *Добавить слой* $\\longrightarrow$ *Добавить растровый слой*.\n\n![](images/191.png)\n\nПосле открытия файла его лучше сразу перепроецировать на лету в EPSG:3857.\n\n::: callout-tip\nПерепроецирование на лету не будет изменять систему координат слоя, а только изменит систему координат проекта и то, как ваша карта будет отображаться на экране.\n\nПерепроецирование на лету может быть выполнено с использованием кнопки ![](images/Снимок%20экрана%202025-03-03%20в%2017.37.13.png){width=\"200\"} в правом нижнем углу основного окна программы.\n:::\n\nВ результате будет открыто изображение рельефа в оттенках серого цвета.\n\n![](images/192.PNG)\n\nЭто изображение можно сделать цветным, для этого нужно открыть свойства слоя. В настройках стиля нужно выбрать тип изображения **Одноканальное псевдоцветное**.\n\nОдноканальное здесь очевидно потому, что изображение не поделено на каналы и существует только в одном.\n\n![](images/193.PNG)\n\n![](images/194.PNG)\n\nГрадиент можно также создать самостоятельно с помощью редактора градиентов.\n\n![](images/195.PNG)\n\n![](images/196.PNG)\n\nИли выбрать из готового каталога градиентов. Для этого при создании нового градиента нужно выбрать каталог **cpt-city**.\n\n![](images/198.PNG)\n\nДалее в каталоге слева выбрать тип градиента Topography и подобрать нужный градиент (можно взять elevation или с3t3).\n\n![](images/199.PNG)\n\n![Градиент c3t3](images/200.PNG)\n\n# Теневой рельеф[^3]\n\n[^3]: <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#hillshade>\n\n## Расчет теневого рельефа\n\nДля более наглядного отображения рельефа на карте рассчитывается теневой рельеф, который строится с использованием позиции источника направленного света, или теневая отмывка.\n\n![](images/201.PNG)\n\nВ данном случае одним из самых важных параметров является **Масштабирование по Z -** этот параметр позволяет соотнести между собой единицы измерения плановых координат и высот. В нашем случае высоты в ячейках растра приведены в метрах, а координаты - в градусах., кроме того, стоит учитывать, что в географических системах координат искажение зависит от долготы.\n\nС этим можно справиться двумя способами - перепроецировать растра в прямоугольную систему координат или задать масштабирование по Z (Z-factor). Фактически с помощью этого коэффициента мы переходим от градусов к метрам. Так как у нас окрестности Эльбруса, то можно воспользоваться значением коэффициента для 40 градусов долготы - 0.00001171.[^4]\n\n[^4]: <https://www.esri.com/arcgis-blog/products/product/imagery/setting-the-z-factor-parameter-correctly/>\n\nАзимут и вертикальный угол задают положение источника света.\n\n![Теневой рельеф (теневая отмывка)](images/202.PNG)\n\nЭтот теневой рельеф можно использовать, чтобы добавить дополнительный объем подложке (предварительно нужно добавить) или исходному рельефу растра. Для этого нужно открыть свойства слоя с теневым рельефом и изменить режим смешивания на Добавление, Осветление или Затемнение (также можно поэкспериментировать с настройками яркости и контрастности).\n\n![](images/203.PNG)\n\n![](images/204.PNG)\n\n![](images/205.PNG)\n\n![](images/206.PNG)\n\n::: callout-tip\nТакже можно воспользоваться функцией Цветной рельеф, которая позволяет создавать классы автоматически и задавать им цвет.\n\n![](images/209.PNG)\n\n![](images/210.PNG)\n\nС использованием такого растра может быть построена трехмерная поверхность, отображающая рельеф местности, а также выполнен ряд вычислений для анализа рельефа.\n\n![](images/clipboard-3288096992.png){fig-align=\"center\" width=\"492\"}\n\nВсе растровые операции здесь осуществляются за счет разности значений между ячейками.\n:::\n\n## Настройка теневого рельефа как стиля растрового слоя\n\nРассчитывать теневой рельеф и сохранять его в отдельный слой не обязательно, вы можете просто выбрать его как тип стиля для растрового слоя в настройках свойств.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.31.31.png){fig-align=\"center\"}\n\nПолученный теневой рельеф после настройки будет отображен на карте.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.32.40.png){fig-align=\"center\"}\n\n::: callout-caution\nПри создании теневого рельефа с использованием настроек стиля растрового слоя на карте могут появляться артефакты - небольшая \"рябь\" в картинке.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.33.35.png){fig-align=\"center\"}\n:::\n\n## Использование модуля Terrain shading\n\nБолее художественных результатов при создании теневого рельефа позволяет добиться модуль [Terrain shading](https://plugins.qgis.org/plugins/TerrainShading/).\n\nЧуть подробнее про его функции можно почитать в [блоге разработчика](https://landscapearchaeology.org/qgis-terrain-shading/).\n\nУстановка модуля осуществляется стандартно (*Модули* $\\longrightarrow$ *Управление модулями*). После установки модуль должен появиться у вас в панели Инструменты анализа.\n\n![](images/Снимок%20экрана%202025-03-13%20в%2016.47.37.png){fig-align=\"center\" width=\"600\"}\n\nМодуль содержит сразу три функции, которые позволяют строить теневую отмывку:\n\n-   *Hillshade (terrain shading)* - аналогичен стандартному построению теневого рельефа;\n\n![Результат расчета Hillshade](images/Снимок%20экрана%202025-03-13%20в%2016.52.57.png){fig-align=\"center\"}\n\n-   *Shadow depth* - инструмент для генерации теней;\n\n![Результат расчета Shadow depth](images/Снимок%20экрана%202025-03-13%20в%2016.53.46.png){fig-align=\"center\"}\n\n-   *Toposhade* - комбинация теневого рельефа и индекса топографического положения (о нем будет еще чуть дальше), который показывает выпуклость и вогнутость рельефа. Такая комбинация позволяет добиться более выраженной карты теневого рельефа.\n\n![Результат расчета Toposhade](images/Снимок%20экрана%202025-03-13%20в%2016.54.34.png){fig-align=\"center\"}\n\n::: callout-tip\nПолученные новые растры можно комбинировать друг с другом и другими слоями для получения более красивого результата.\n\n![Shadow depth и Hillshade (для обоих установлен режим смешивания Затемнение) в сочетании с подложкой 2GIS](images/Снимок%20экрана%202025-03-13%20в%2016.55.57.png){fig-align=\"center\"}\n:::\n\n# Расчет параметров рельефа\n\n## Крутизна склонов[^5]\n\n[^5]: Документация функции <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#slope>\n\nРасчет крутизны склонов или их уклона и экспозиции осуществляется на основе производных первого порядка.\n\n![Определение основных геоморфометрических параметров по Zevenbergen, Thorne (1987). Источник: https://gis-lab.info/qa/geomorphometric-parameters-theory.html](images/800px-Geomorpho_theory_03.png){fig-align=\"center\"}\n\n### Расчет крутизны склонов\n\nРассчитаем крутизну склонов - угол наклона каждого склона в градусах.\n\n![](images/207.PNG)\n\n![](images/208.PNG)\n\n### Выделение территорий пригодных для строительства с учетом уклона\n\nДля того, чтобы выделить области пригодные для строительства, воспользуемся переклассификацией растра.\n\nПри переклассификации будем рассматривать территории с уклоном менее 10 %.\n\n![](images/photo_2025-02-24_21-18-02.jpg){fig-align=\"center\" width=\"800\"}\n\nТак как уклон был рассчитан в градусах, а параметр пригодности для строительства задан в процентах, то пересчитаем этот параметр в градусы по формуле:\n\n$$\nSlope_{degree}=arctg(\\dfrac{Slope_{percent}}{100})\n$$\n\nПолученное значение пригодности - 6 градусов.\n\nПереклассифицируем растр и выделим области пригодные или непригодные для строительства.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2012.12.49.png){fig-align=\"center\"}\n\n::: callout-important\nОбратите внимание, что здесь в дополнительных параметрах можно указать, как именно будут задаваться границы интервалов, то есть будут ли включаться в них нижний или верхний предел интервала.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2012.18.05.png){fig-align=\"center\" width=\"600\"}\n:::\n\nВ таблице реклассификации следует ввести границы интервалов и соответствующее им значение (эти значения должны быть целочисленными.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2012.12.25.png){fig-align=\"center\"}\n\nВ результате будет получен дискретный растр с двумя значениями (или с тем количеством значений классов, которое вы указали в таблице реклассификации.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2012.21.50.png){fig-align=\"center\"}\n\n## Экспозиция склонов[^6]\n\n[^6]: Экспозиция - <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#aspect>\n\n*Экспозиция поверхности – угол по часовой стрелке между определенным направлением (как правило, на север) и проекцией уклона на горизонтальную плоскость; фиксирует направление (азимут) максимального уклона (градиента) земной поверхности*[^7].\n\n[^7]: Основные геоморфометрические параметры: теория - [https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5\\_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5\\_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B](https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B,){.uri}\n\nЭта функция позволяет определить ориентацию склонов по сторонам света.\n\n![](images/211.PNG)\n\n![](images/212.PNG)\n\n## Расчет неоднородности рельефа[^8]\n\n[^8]: <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#ruggedness-index>\n\nТакже по растру с данными о рельефе может быть рассчитана неоднородность рельефа.\n\nЭтот показатель рассчитывается на основе разности значений между пикселями в сетке 3 на 3. Таким образом, каждый полученный пиксель содержит разницу между центральным пикселем и 8 его окружащими.\n\n![Riley et al (1999) “A Terrain ruggedness Index That Quantifies Topographic heterogeneity”[^9]](images/Снимок%20экрана%202025-03-14%20в%2014.09.56.png){fig-align=\"center\"}\n\n[^9]: <https://download.osgeo.org/qgis/doc/reference-docs/Terrain_Ruggedness_Index.pdf>\n\n[^10]: <https://download.osgeo.org/qgis/doc/reference-docs/Terrain_Ruggedness_Index.pdf>\n\n![](images/213.PNG)\n\n![](images/214.PNG)\n\n# Построение трехмерной поверхности\n\nТакже QGIS поддреживает отображение трехмерных поверхностей. Для этого нужно просто в строке меню выбрать **Вид - Новая 3D карта**.\n\n![](images/215.png)\n\nПосле чего в окне программы появится окно трехмерной карты (перемещение по карте левой кнопкой мыши, поворот и наклон - колесико, приближение - правая кнопка мыши).\n\n![](images/216.PNG)\n\nСразу после открытия нового окна поверхность все еще является плоской, потому что не задано на основе чего строить трехмерную поверхность.\n\nВ окне трехмерной карты нужно нажать кнопку **Настройки** (в панели значков крайняя справа) и в открывшемся окне настроек выбрать тип **DEM (raster layer)**, **высота** (растровый слой с высотами) и **вертикальный масштаб** (здесь лучше всзять что-то от 1 до 5, чтобы поверхность была повыразительнее).\n\nДополнительно можно добавить **Terrain shading** (фактически теневая отмывка) и подкорректировать **tile resolution** (чем больше, тем более подробным будет рельеф), и **skirt height** (если правильно нашла - высота подставки под саму поверхность).\n\n![](images/217.PNG)\n\nПосле чего в окне будет отображена трехмерная поверхность.\n\n![](images/218.PNG)\n\n# Создание горизонталей\n\nИз растра со значениями высот могут быть извлечены горизонтали\n\n![](images/219.png)\n\nРасстояние между изолиниями - это фактически высота сечения рельефа, то есть через сколько мы будем проводить горизонтали.\n\n![](images/220.PNG)\n\nПолученные изолинии\n\n![](images/221.PNG)\n\nНастроим горизонтали таким образом, чтобы каждая пятая была утолщенной, добавим подписи и настроим их так, чтобы они были \"головой вверх\".\n\nНачнем с настройки толщины линий. Для этого в свойствах слоя выберем настройку толщины в зависимости от выражения.\n\n![](images/222.png)\n\nДалее пропишем логическое выражение: **if(\"ELEV\"%500=0,0.7,0.3)**. В этом выражении перед запятой прописано условие - высота горизонтали делится на 500 без остатка, потом толщина линии, если условие выполняется, и толщина, если условие не выполняется.\n\n![](images/223.PNG)\n\nРезультат\n\n![](images/224.PNG)\n\nДобавим подписи.\n\n![](images/225.PNG)\n\nНо при таком добавлении подписей, будут подписаны все горизонтали, а мы хотим подписать только утолщенные. Для этого нужно прописать выражение, подобное тому, что мы писали выше: **if(\"ELEV\"%500=0,\"ELEV\",\"\").**\n\n![](images/226.PNG)\n\nДобавим белую обводку подписям, чтобы они не сливались с горизонталями\n\n![](images/227.PNG)\n\nСделаем так, чтобы они размещались на линии и изгибались в соответствии с ней.\n\n![](images/228.PNG)\n\nИ настроим подписи так, чтобы все они смотрели головой в сторону увеличения высоты.\n\n![](images/229.PNG)\n\n![](images/230.PNG)\n\nВ результате получим горизонтали, где каждая пятая будет утолщена и подписана головой в сторону увеличения.\n\n![](images/231.PNG)\n\n# Построение профиля местности\n\nВ актуальных версиях программы построения профиля местности по цифровой модели рельефа является функцией по умолчанию. Этот инструмент можно открыть из строки меню *Вид* $\\longrightarrow$ *Профиль высот*.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2013.07.28.png){fig-align=\"center\" width=\"600\"}\n\nОкно профиля высот открывается в нижней части интерфейса. Ваша цифровая модель рельефа (если растр с ней загружен в проект должна автоматически добавиться в левую часть окна построения профиля.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2014.14.16.png){fig-align=\"center\"}\n\n::: callout-important\nЕсли ваша цифровая модель рельефа не добавилась в высотный профиль автоматически, то вам нужно проверить ее настройки.\n\nВ свойствах слоя (открываются двойным кликом или кликом правой кнопки мыши и выбором пункта *Свойства* из открывшегося контекстного меню) необходимо найти пункт *Высота* и поставить галочку напротив настройки *\"Представляет собой данные высоты\"*.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2014.16.24.png){fig-align=\"center\"}\n\nПосле этого ваша цифровая модель будет автоматически добавлена в окно высотного профиля.\n:::\n\nПостроение профиля может происходить двумя способами:\n\n-   *Захват кривой* ![](images/Снимок%20экрана%202025-03-12%20в%2014.19.51.png){width=\"35\" height=\"32\"} - отрисовка линии профиля осуществляется вручную прямо на карте;\n\n-   *Захват кривой из объекта* ![](images/Снимок%20экрана%202025-03-12%20в%2014.20.03.png){width=\"36\"} - использование уже существующей линии из векторного слоя.\n\nВ первом случае необходимо просто нарисовать нужную вам линию профиля (она может быть отрисована как любая ломаная линия), по которой будет происходить построения.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2014.22.05.png){fig-align=\"center\"}\n\nПри перемещении курсора по графику или линии профиля вы увидите перемещающуюся точку, показывающую конкретное положение.\n\n```{=html}\n<iframe width=\"800\" height=\"400\" src=\"images/Запись экрана 2025-03-12 в 14.24.11.mp4\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe>\n```\n\nФункция прилипания ![](images/Снимок%20экрана%202025-03-12%20в%2014.49.40.png){width=\"38\" height=\"34\"} как и при обычной векторизации позволяет использовать другие объекты в качестве исходных.\n\nПолученный профиль вы можете сохранить в виде картинки графика или файла pdf ![](images/Снимок%20экрана%202025-03-12%20в%2014.51.16.png){width=\"67\" height=\"35\"} или же результаты могут быть сохранены в виде линии профиля (в двумерном и трехмерном видах) для последующего использования в ГИС или CAD программах и в виде таблицы значений высот вдоль профиля.\n\n![](images/Снимок%20экрана%202025-03-12%20в%2014.51.32.png){fig-align=\"center\" width=\"400\"}\n\n# Выявление форм рельефа\n\n::: callout-warning\nТе инструменты и функции, которые описаны, начиная с этого раздела, к сожалению, могут работать нестабильно или не запуститься вообще (может зависеть от вашей системы и настроек компьютера).\n:::\n\n::: callout-important\nДля нижеописанных расчетов используются инструменты программы SAGA. Как и QGIS это бесплатное программное обеспечение.\n\nЕе вы можете установить себе на компьютер как отдельное приложение, скачав, например, по [ссылке](https://sourceforge.net/projects/saga-gis/). Возможно она у вас уже установлена вместе с QGIS (если вы устанавливали его пакетно).\n\nЛибо вы можете воспользоваться этими инструментами напрямую из QGIS. Для этого необходимо установить модуль *Processing Saga NextGen Provider*, после чего скачать программу для своей операционной системы по [ссылке](https://sourceforge.net/projects/saga-gis/) и разместить на своем компьютере в папке в надежном месте. Далее в настройках программы QGIS вам нужно прописать, где же хранится SAGA.[^11]\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.33.30.png){fig-align=\"center\"}\n\nУстановку для Windows можно посмотреть в видео по [ссылке](https://www.youtube.com/watch?v=VKdaripCups&ab_channel=cornell-gis).\n:::\n\n[^11]: <https://gis.stackexchange.com/questions/468320/installing-saga-next-gen-binaries-in-qgis-on-a-mac>\n\n## Расчет структурных линий рельефа\n\nВыделение структурны линий рельефа можно осуществить с использованием инструмента *Surface specific points* в наборе инструментов SAGA.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2014.15.41.png){fig-align=\"center\"}\n\nЧем большее значение порога вы установите, тем более крупные структурные линии будут выделяться.\n\n![](images/image_2025-03-14_14-16-59.png){fig-align=\"center\"}\n\n## Определение выпуклых и вогнутых форм рельеф\n\nФормы рельефа определяются на основе *индекса топографического положения (Topographic position index - TPI)*. Этот индекс позволяет классифицировать формы рельефа по высоте конкретного пикселя относительно соседей: если он ниже, то значение индекса будет отрицательным и он будет отнесен к вогнутой форме рельефа; если он выше соседей, то индекс будет больше нуля и этот пиксель будет классифицирован как выпуклая часть рельефа.\n\n![Источник: https://landscapearchaeology.org/2019/tpi/](images/TPI_diagram.png){fig-align=\"center\"}\n\n![Источник: https://chuck-sutherland.blogspot.com/2019/10/topographic-position-index-tpi-as.html](images/48880191738_a91f4757a2_c.jpg){fig-align=\"center\"}\n\n### Расчет стандартными инструментами\n\nИндекс топографического положения может быть рассчитан с использованием стандартного инструмента из строки меню: *Растр* $\\longrightarrow$ *Анализ* $\\longrightarrow$ *Индекс топографического положения (TPI)*.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.41.05.png){fig-align=\"center\"}\n\nЗдесь достаточно указать растр, используемый для расчета и необходимость обработки краев: так как расчеты осуществляются с использованием движущегося окна вокруг каждого из пикселей, то края обычно не обрабатываются, так как эти пиксели не имеют достаточного числа соседей.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.48.52.png){fig-align=\"center\"}\n\nПолученный результат вы увидите на растре (на картинке ниже взята цветная шкала, по умолчанию вы получите изображение в оттенках серого).\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.54.09.png){fig-align=\"center\" width=\"647\"}\n\nВ примере превалируют либо ровные области, либо небольшие выпуклости и вогнутости рельефа.\n\nОднако такой результат может быть еще связан с небольшим окном для расчетов. Другие варианты расчета дают большую гибкость и позволяют четче выделять формы рельефа.\n\n### Расчет с использованием функций SAGA\n\nВ наборе инструментов SAGA есть целая группа, предназначенная специально для морфометрического анализа рельефа - *Terrain analysis - Morphometry*, среди которых в том числе есть и расчет индекса топографического положения - *Topographic position index (tpi)*.\n\nИспользование этого инструмента в отличие от стандартного дает больше контроля пользователю, так как здесь можно выбирать размер ячеек для анализа, а также задавать весовые значения.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2011.56.44.png){fig-align=\"center\"}\n\nЗа счет большей адаптивности этого инструмента получается более легко и наглядно интерпретируемый результат.\n\n![](images/image_2025-03-14_12-16-51.png){fig-align=\"center\"}\n\n::: callout-note\nТакже есть инструмент для классификации форм рельефа на основе индекса топографического положения - *Tpi based land form classification*.\n\nНо, к сожелению, у меня расчет этим инструментов так и не окончился успехом.\n:::\n\n### Расчет с использованием модуля Terrain shading\n\n:::: callout-important\nДля расчетов топографического индекса положения необходимо, чтобы данные были в прямоугольной системе координат, поэтому растр с цифровой моделью рельефа необходимо перепроецировать: *Растр* $\\longrightarrow$ *Проекции* $\\longrightarrow$ *Деформация (перепроецирование)*.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.40.23.png){fig-align=\"center\"}\n\n::: callout-tip\nНаиболее оптимальным является перепроецирование в плоскую прямоугольную систему координат из группы систем координат UTM. Для расчета нужной вам зоны системы координат можно воспользоваться сервисом по ссылке <https://www.latlong.net/lat-long-utm.html>\n:::\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.43.39.png){fig-align=\"center\"}\n::::\n\nДля расчета индекса топографического положения воспользуемся инструментом *Topographic position (TPI)*.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.45.22.png){fig-align=\"center\"}\n\nТак же как и для инструментов SAGA вы можете здесь настроить возможность использования весов и радиус обработки.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.48.19.png){fig-align=\"center\"}\n\n::: callout-tip\nЧем больший радиус вы установите, тем более крупные формы рельефа будут обнаруживаться.\n:::\n\nНедостатком полученного результата будет являться добавление дополнительных пикселей вдоль границ исходного растра со значениями, лежащими за пределами корректного диапазона индекса.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.52.26.png){fig-align=\"center\"}\n\nОднако это можно исправить настройкой стиля слоя, в которых можно указать минимальные и максимальные значения растра и исключить все, что не попадает в пределы диапазона.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.52.02.png){fig-align=\"center\"}\n\nПолученный результат хоть и будет содержать небольшую рамку, но уже не будет так сильно искажать интерпретацию.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.56.12.png){fig-align=\"center\"}\n\nТакже полученный растр можно обрезать по маске.\n\n::: callout-tip\nКак показали несколько попыток расчета можно попробовать осуществить его для растра в географической системе координат, так вы не получите дополнительных полей по краям.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2012.50.19.png){fig-align=\"center\"}\n:::\n\n::: callout-tip\nДополнительно вы можете наложить на свой растр с индексом топографического положения горизонтали, чтобы понять, действительно ли рельеф изменяется согласно полученным значениям.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2014.14.08.png){fig-align=\"center\"}\n:::\n\n# Классификация форм рельефа\n\nАлгоритм классификации форм рельефа в наборе инструментов SAGA основан на статье **Iwahashi, J. & Pike, R.J. (2007):** Automated classifications of topography from DEMs by an unsupervised nested-means algorithm and a three-part geometric signature.\n\nВ соответствии с предложенными авторами алгоритмом вся территория автоматически делится на категории по форме поверхности с использованием - градиента склона, локальной выпуклости и текстуре поверхности.\n\n![](images/Снимок%20экрана%202025-03-14%20в%2014.26.11.png){fig-align=\"center\"}\n\n![](images/image_2025-03-14_14-21-53.png){fig-align=\"center\"}\n\n# Определение открытых и закрытых элементов рельефа\n\nДля расчета открытых и закрытых форм рельефа в комплекте инструментов SAGA есть *Topographic openness*, которая позволяет рассчитать два растра: с открытыми формами и закрытыми соответственно.\n\n![](images/image_2025-03-14_13-13-14.png){fig-align=\"center\"}\n\n![Открытые выпуклые формы рельефа](images/image_2025-03-14_13-13-52.png){fig-align=\"center\"}\n\n![Закрытые формы рельефа](images/image_2025-03-14_13-14-15.png){fig-align=\"center\"}\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"relief.html"},"language":{"toc-title-document":"Содержание","toc-title-website":"Содержание","related-formats-title":"Другие форматы","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Источник","other-links-title":"Другие ссылки","code-links-title":"Ссылки на код","launch-dev-container-title":"Запустить Dev Container","launch-binder-title":"Запустить Binder","article-notebook-label":"Блокнот статьи","notebook-preview-download":"Скачать блокнот","notebook-preview-download-src":"Скачать исходный код","notebook-preview-back":"Вернуться к статье","manuscript-meca-bundle":"Архив MECA","section-title-abstract":"Аннотация","section-title-appendices":"Приложения","section-title-footnotes":"Сноски","section-title-references":"использованная литература","section-title-reuse":"Повторное использование","section-title-copyright":"Авторские права","section-title-citation":"Цитата","appendix-attribution-cite-as":"Пожалуйста, цитируйте эту работу как:","appendix-attribution-bibtex":"BibTeX","appendix-view-license":"Просмотреть Лицензию","title-block-author-single":"АВТОР","title-block-author-plural":"Авторы","title-block-affiliation-single":"Организация","title-block-affiliation-plural":"Принадлежности","title-block-published":"Дата публикации","title-block-modified":"Файл изменен","title-block-keywords":"Ключевые слова","callout-tip-title":"Дополнительно","callout-note-title":"На заметку","callout-warning-title":"Внимание","callout-important-title":"Важно","callout-caution-title":"Предупреждение","code-summary":"Код","code-tools-menu-caption":"Код","code-tools-show-all-code":"Развернуть код","code-tools-hide-all-code":"Скрыть код","code-tools-view-source":"Показать код","code-tools-source-code":"Исходный код","tools-share":"Share","tools-download":"Download","code-line":"Линия","code-lines":"Линии","copy-button-tooltip":"Скопировать текст","copy-button-tooltip-success":"Скопировано","repo-action-links-edit":"Редактировать страницу","repo-action-links-source":"Показать код","repo-action-links-issue":"Сообщить о проблеме","back-to-top":"Наверх","search-no-results-text":"Поиск не дал результатов","search-matching-documents-text":"Результаты поиска","search-copy-link-title":"Скопировать ссылку","search-hide-matches-text":"Скрыть дополнительные результаты","search-more-match-text":"дополнительный результат в этом документе","search-more-matches-text":"дополнительных результата(-ов) в этом документе","search-clear-button-title":"Очистить","search-text-placeholder":"","search-detached-cancel-button-title":"Отменить","search-submit-button-title":"Найти","search-label":"Поиск","toggle-section":"Переключить раздел","toggle-sidebar":"Переключить боковую панель навигации","toggle-dark-mode":"Переключить темный режим","toggle-reader-mode":"Переключить режим чтения","toggle-navigation":"Переключить навигацию","crossref-fig-title":"Рисунок","crossref-tbl-title":"Таблица","crossref-lst-title":"Список","crossref-thm-title":"Теорема","crossref-lem-title":"Лемма","crossref-cor-title":"Следствие","crossref-prp-title":"Утверждение","crossref-cnj-title":"Гипотеза","crossref-def-title":"Определение","crossref-exm-title":"Пример","crossref-exr-title":"Упражнение","crossref-ch-prefix":"Глава","crossref-apx-prefix":"Приложение","crossref-sec-prefix":"Глава","crossref-eq-prefix":"Уравнение","crossref-lof-title":"Список Иллюстраций","crossref-lot-title":"Список Таблиц","crossref-lol-title":"Список Каталогов","environment-proof-title":"Доказательство","environment-remark-title":"Примечание","environment-solution-title":"Решение","listing-page-order-by":"Сортировать по","listing-page-order-by-default":"предварительно выбранный","listing-page-order-by-date-asc":"Самый старый","listing-page-order-by-date-desc":"Новейшие","listing-page-order-by-number-desc":"нисходящий","listing-page-order-by-number-asc":"по возрастанию","listing-page-field-date":"Дата","listing-page-field-title":"Заголовок","listing-page-field-description":"Описание","listing-page-field-author":"Автор","listing-page-field-filename":"Имя файла","listing-page-field-filemodified":"Файл изменен","listing-page-field-subtitle":"Подзаголовок","listing-page-field-readingtime":"Время чтения","listing-page-field-wordcount":"Подсчет слов","listing-page-field-categories":"Категории","listing-page-minutes-compact":"{0} минут","listing-page-category-all":"Все","listing-page-no-matches":"Нет подходящих элементов","listing-page-words":"{0} слов","listing-page-filter":"Фильтр","draft":"Черновик"},"metadata":{"lang":"ru-RU","fig-responsive":true,"quarto-version":"1.7.32","editor":"visual","theme":"flatly","title":"Анлиз рельефа"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}