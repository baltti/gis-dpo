---
title: "Тематические карты"
---

# Исходные данные

В качестве исходных данных для этого раздела будут использованы сведения о количестве населения по муниципальным образованиям Санкт-Петербурга.

Данные о количестве населения приведены на 1 января 2025 года по данным Росстата <https://78.rosstat.gov.ru/folder/27595>

Исходный слой приведен в системе координат UTM 36 зона для Северного полушария (`EPSG:32636`).

Полный датасет можно скачать по ссылке <https://disk.yandex.ru/d/V7NKKt-PpK4UzQ>

# Карта пропорциональных символов

В этом типе тематических карт отображение происходит с помощью размера символов, который пропорционален величине показателя.

Для создания карты пропорциональных символов так, чтобы вам было доступно создание легенды для карты, в первую очередь следует получить точечный слой на основе полигональных объектов.

Для этого воспользуемся инструментом *Точка на поверхности* из *Панели инструментов анализа*.

::: callout-note
Этот инструмент дублирует инструмент *Центроид* с одной небольшой разницей: в случае невыпуклого многоугольника при использовании *Центроида* точка будет лежать за пределами полигона, тогда как при использовании *Точки на поверхности* точка будет смещена внутрь.
:::

![](images/clipboard-1067695315.png)

В результате вы получите новый слой с точечными объектами, которые будут иметь те же атрибуты, что и исходные полигоны.

![](images/clipboard-4058950745.png){fig-align="center" width="1292"}

В первую очередь следует определить размер знаков.

![](images/clipboard-3621253768.png){fig-align="center" width="1170"}

В открывшемся окне следует указать поле, по которому размер будет задан и его значения.

![](images/clipboard-1545387451.png){fig-align="center" width="783"}

Для того, чтобы размер символов был отображен в легенде, следует выбрать настройку *Размер условных определяется данными...*

![](images/clipboard-2320175714.png){fig-align="center" width="1445"}

После этого вы можете настроить свою легенда и выбрать ее тип.

![](images/clipboard-2588932872.png){fig-align="center" width="704"}

В результате вы получите свою карту с готовой легендой, которую можно использовать для оформления.

![](images/clipboard-3969644739.png){fig-align="center" width="1280"}

::: callout-tip
Размер символов как визуальная переменная хорошо сочетается с цветом, который вы можете использовать для отображения того же показателя или другого.
:::

# Карта плотности точек

В карте плотности точек количество точек будет отображать величину показателя.

Для ее создания воспользуемся возможностью создания многослойных символов.

![](images/clipboard-1040508788.png){fig-align="center" width="1557"}

В этом случае каждый из полигонов будет заполнен заданным количеством маркеров, которые будут размещены случайным образом.

Так как нам необходимо, чтобы количество маркеров было пропорционально количеству населения, то воспользуемся опцией переопределения показателя из данных.

![](images/clipboard-3203631890.png)

В открывшемся окне воспользуемся редактором выражений.

В данном случае поделим общее количество населения на 1 000, таким образом 1 точка на карте будет соответствовать 1 000 человек, проживающих в определенном муниципальном образовании.

![](images/clipboard-540567482.png)

::: callout-note
Рекомендуется выбирать это число таким образом, чтобы в каждом из исходных объектов было хотя бы несколько точек.
:::

![](images/clipboard-2718220076.png){fig-align="center" width="816"}

::: callout-note
Обратите внимание, что вы можете настраивать стиль слоев символа независимо друг от друга.
:::

# Фоновая картограмма

Фоновая картограмма - один из самых наиболее известных типов тематических карт, в которых показатель отображается цветом или штриховкой.

Для ее создания достаточно просто воспользоваться уже знакомым вам символом по диапазонам значений.

Однако следует помнить, что при использовании фоновых картограмм рекомендуется брать относительные значения показатей, например, вместо количества населения - плотность населения на единицу площади.

В наших исходных данных в таблице атрибутов приведено именно количество населения, поэтому необходимо перейти от него к плотности. Сделать это можно двумя способами: рассчитав плотность как отдельный атрибут с использованием калькулятора полей или воспользоваться выражением вместо конкретного атрибута при задании стиля символа.

Воспользуемся вторым способом и выражением:

```         
"population" /( area( \$geometry)/10000)
```

В этом выражении количество населения поделено на рассчитанную площадь муниципального образования, которая переведена в километры квадратные.

![](images/clipboard-159582046.png){fig-align="center" width="1386"}

Вы также можете выбрать градиент, который вам больше нравится, но рекомендуется использовать градиенты от светлого к темному (при светлом фоне) или от темного к светлому (при темном фоне).

![](images/clipboard-2077631987.png){fig-align="center" width="1305"}

::: callout-tip
Если вы хотите, чтобы под вашими полигонами читалась подложка, то вы можете воспользоваться режимом смешивания.

![](images/clipboard-1368617368.png){fig-align="center" width="734"}

![](images/clipboard-2310841741.png){fig-align="center" width="597"}
:::

# Анаморфная карта

Анаморфная карта предполагает отображение показателя с помощью размера объекта, но, в отличие от пропорциональных символов, здесь используется исходная геометрия объектов, которая искажается пропорционально величине показателя.

::: callout-important
Следует помнить, что в анаморфной карте искажаются форма и размер объектов.
:::

В QGIS отсутствует инструмент по умолчанию для создания анаморфной карты, поэтому следует воспользоваться модулем *Cartogram3*. Этот модуль появится у вас на панели инструментов в виде значка ![](images/clipboard-3011523126.png){width="51"}.

В открывшемся окне модуля необходимо выбрать слой, для которого анаморфная карта рассчитывается, показатель и указать критерии остановки (максимальное число итераций или максимальная средняя ошибка).

::: callout-warning
Чем выше значения критерия остановки, тем сильнее будет искажение в итоговой карте.
:::

![](images/clipboard-2327725931.png){fig-align="center" width="1033"}

На полученной карте муниципальные образования с большим количеством населения будут "раздуты", а с маленьким наоборот - уменьшены.

![](images/clipboard-1920263839.png){fig-align="center" width="822"}

# Несмежная картограмма

Несмежная картограмма отчасти следует принципу создания анаморфной карты, то есть искажает размер объектов так, чтобы он был пропорционален величине показателя, но здесь нарушается топология объектов, то есть они перестают иметь общие границы при обзем сохранении формы объектов.

Несмежную картограмму мы создадим с использованием *Генератора геометрии*, которы позволяет создавать объекты с измененной геометрией на карте, не меняя геометрии в слоев.

![](images/clipboard-3634800827.png)

Для генератора воспользуемся следующим выражением:

```         
scale( $geometry, "population"/maximum("population"), "population"/maximum("population"))
```

Это выражение масштабирует объекты, в качестве первого аргумента здесь указывается, что масштабировать, а второй и третий - это величина масштабирования по оси X и Y соответственно.

В результате вы получите слой с отмасштабированными пропорционально количеству населения муниципальными образованиями.

![](images/clipboard-1736216075.png){fig-align="center" width="866"}

# Создание атласа

Атлас в QGIS позволяет автоматически создать несколько листов карты на основе какого-то условия группировки.

Например, мы можем сделать атлас для нашей карты с количеством населения в муниципальных образованиях, где на одном листе будет показан один район.

Для того, чтобы сделать из макета карты атлас, то есть серию карт нам необходимо условие группировки объектов, в качестве которого будет выступать административный район.

Чтобы получить слой с районами, воспользуемся инструментом *Агрегировать*.

![](images/clipboard-132240609.png){fig-align="center" width="1234"}

Полученный слой с районами будет добавлен на карту.

![](images/clipboard-3411287838.png){fig-align="center" width="700"}

Создадим новый макет, в котором с помощью кнопки *Настройки атласа* ![](images/clipboard-3559860220.png){width="53"} создадим атлас.

![](images/clipboard-2311260017.png){fig-align="center" width="628"}

Страницы атласа в данном случае будут создаваться по районам.

::: callout-note
Для создания страниц атласа не обязательно, чтобы слой, по которому они создаются был видимым в проекте.
:::

Просмотр страниц атласа включается по кнопке *Предпросмотр атласа* ![](images/clipboard-3849118511.png){width="52"}.

Для того, чтобы масштаб карты подстраивался под содержимое настроим масштаб под объекты, определяющие страницы нашего атласа. Для этого откроем свойства карты и найдем настройку масштаба атласа. Нужно установить настройку масштаба атласа по размерам объектов с полем. Так карта будет автоматически масштабироваться на каждом листе так, чтобы на ней размещался только один из районов.

![](images/clipboard-2990666627.png){fig-align="center" width="509"}

В итоге каждый лист будет центрироваться на одном из районов, а масштаб будет подбираться так, чтобы район целиком помещался на карту.

Для того, чтобы район был очевиднее на листе, настроим стиль объектов так, чтобы район листа был обведен более толстым контуром.

Вернемся в основное окно программы, и настроим стиль обводки на основе выражения:

```         
if ( @atlas_pagename =  "NAME"  ,1, 0.3)
```

![](images/clipboard-3451026842.png){fig-align="center" width="1487"}

![](images/clipboard-3449353156.png)

Это выражение с условием "если", в котором в качестве аргументов передаются:

-   условие;

-   толщина обводки в том случае, если условие выполнено;

-   толщина обводки, если условие не выполнено.

Что же значит переменная `@atlas_pagename`? Эта переменная указывает на то, что для задания стиля здесь нужно использовать тот район, на странице которого сейчас открыт наш атлас.

![](images/clipboard-1306378304.png){fig-align="center" width="1600"}

![](images/clipboard-1256646298.png){fig-align="center" width="918"}
